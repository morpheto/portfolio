<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Orhun Ege Eker — Space Portfolio (Stable)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#05060a; --text:#f6f7fb; --muted:#cbd5e1; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  canvas#scene{position:fixed;inset:0;width:100%;height:100%;display:block;outline:none}

  .hud{
    position:fixed;top:12px;left:12px;right:12px;z-index:20;
    display:flex;align-items:center;justify-content:space-between;
    padding:10px 14px;background:rgba(8,10,18,.45);backdrop-filter:blur(8px) saturate(140%);
    border:1px solid rgba(255,255,255,.12);border-radius:16px
  }
  .brand{font-weight:800;letter-spacing:.4px;font-size:16px}
  .nav{display:flex;gap:16px}
  .nav a{color:var(--text);text-decoration:none;opacity:.9;position:relative;font-size:14px}
  .nav a:after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:#2b2d33;transform:scaleX(0);transform-origin:left;transition:transform .25s}
  .nav a:hover{opacity:1}.nav a:hover:after{transform:scaleX(1)}

  .help{
    position:fixed;right:12px;bottom:12px;z-index:20;color:var(--muted);font-size:12px;line-height:1.5;
    padding:10px 12px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(255,255,255,.06);backdrop-filter:blur(6px)
  }

  .overlay{position:fixed;inset:0;pointer-events:none;z-index:12}
  .planet-card{
    position:absolute;transform:translate(-50%,-100%);width:260px;max-width:40vw;
    border-radius:14px;overflow:hidden;border:1px solid rgba(120,198,255,.28);
    background:linear-gradient(180deg, rgba(20,24,40,.85), rgba(10,12,20,.9));
    box-shadow:0 10px 26px rgba(0,0,0,.45), 0 0 22px rgba(64,191,255,.18);
    transition:opacity .18s ease, transform .18s ease;opacity:.0;
  }
  .planet-card__media{height:140px;background:#0f1430;background-size:cover;background-position:center}
  .planet-card__meta{display:flex;justify-content:space-between;align-items:center;padding:8px 10px}
  .title{font-weight:700}
  .tag{font-size:12px;color:#e5eaf3;opacity:.85}
  .badge{
    position:absolute;left:8px;top:8px;background:rgba(64,191,255,.12);
    border:1px solid rgba(64,191,255,.4);backdrop-filter:blur(6px);
    font-size:11px;padding:6px 8px;border-radius:999px;color:#cfefff
  }

  .hint{
    position:absolute;transform:translate(-50%,-120%);padding:6px 10px;border-radius:999px;
    border:1px solid rgba(120,198,255,.35);background:rgba(64,191,255,.10);
    color:#dff2ff;font-size:12px;letter-spacing:.2px;pointer-events:none;
    box-shadow:0 0 16px rgba(64,191,255,.25);z-index:25;display:none
  }

  .popup{position:fixed;inset:0;z-index:30;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);backdrop-filter:blur(4px)}
  .popup.show{display:flex}
  .popup-card{width:min(880px,92vw);border:1px solid rgba(120,198,255,.28);border-radius:18px;background:#0b0f1c;box-shadow:0 20px 60px rgba(0,0,0,.55);overflow:hidden}
  .popup-media{height:min(56vh,500px);background:#0e1433;background-size:cover;background-position:center}
  .popup-body{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
  .popup-title{font-weight:800;font-size:18px}
  .popup-tag{font-size:12px;color:#cfd6e3}
  .popup-actions{display:flex;gap:10px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(120,198,255,.3);background:#10172b;color:#fff;font-size:14px;text-decoration:none;cursor:pointer}
  .btn:hover{background:#13203a}
  .btn.primary{background:#1e5eff;border-color:#2b66ff}
  .btn.primary:hover{background:#2a6bff}
  .popup-close{position:absolute;top:14px;right:14px;border:1px solid rgba(120,198,255,.3);background:rgba(64,191,255,.08);border-radius:10px;padding:6px 10px;cursor:pointer}

  @media (max-width:640px){
    .brand{font-size:14px} .nav a{font-size:13px} .hud{padding:8px 10px}
    .planet-card{width:200px} .planet-card__media{height:110px}
  }
</style>
</head>
<body>
  <div class="hud">
    <div class="brand">ORHUN EGE EKER</div>
    <div class="nav">
      <a href="index.html">WORK</a>
      <a href="about.html">ABOUT</a>
      <a href="contact.html">CONTACT</a>
    </div>
  </div>

  <div class="help">
    <b>Controls</b><br/>
    W / S : Forward / Reverse &nbsp;·&nbsp; A / D : Turn Left / Right<br/>
    Space : Up &nbsp;·&nbsp; Shift : Down &nbsp;·&nbsp; E : Quick View (near)
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="hint" id="hint">Press <b>E</b> to View</div>

  <div class="popup" id="quickview">
    <div class="popup-card" role="dialog" aria-modal="true" aria-labelledby="qvTitle">
      <button class="popup-close" id="qvClose" aria-label="Close">✕</button>
      <div class="popup-media" id="qvMedia"></div>
      <div class="popup-body">
        <div>
          <div class="popup-title" id="qvTitle">Project</div>
          <div class="popup-tag" id="qvTag">Category</div>
        </div>
        <div class="popup-actions">
          <button class="btn primary" id="qvEnter">Enter (E)</button>
          <button class="btn" id="qvExit">Exit (Q)</button>
        </div>
      </div>
    </div>
  </div>

  <canvas id="scene" tabindex="0" aria-label="3D project map"></canvas>

  <!-- Yerelde de çalışan NON-MODULE build -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    /* ===== Renderer / Scene / Camera ===== */
    const canvas = document.getElementById('scene');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    const DPR = Math.min(2, window.devicePixelRatio || 1);
    renderer.setPixelRatio(DPR);
    renderer.setSize(window.innerWidth, window.innerHeight);

    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x05060a, 0.006);

    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 4000);

    /* ===== Lights ===== */
    const hemi = new THREE.HemisphereLight(0x89b4ff, 0x05060a, 0.45);
    scene.add(hemi);
    const key = new THREE.DirectionalLight(0xffffff, 0.9);
    key.position.set(160, 220, 120);
    scene.add(key);
    const rim = new THREE.DirectionalLight(0x6cb8ff, 0.6);
    rim.position.set(-220, 160, -120);
    scene.add(rim);

    /* ===== Starfield ===== */
    (function addStars(){
      const g = new THREE.BufferGeometry();
      const N = 6000, pos = new Float32Array(N*3);
      for(let i=0;i<N;i++){
        const r = 900 + Math.random()*1400;
        const theta = Math.random()*Math.PI*2;
        const u = Math.random()*2 - 1; // cos(phi)
        const s = Math.sqrt(1-u*u);
        pos[i*3+0] = r*s*Math.cos(theta);
        pos[i*3+1] = r*u*0.7;
        pos[i*3+2] = r*s*Math.sin(theta);
      }
      g.setAttribute('position', new THREE.BufferAttribute(pos,3));
      const m = new THREE.PointsMaterial({ size:1.2, sizeAttenuation:true, color:0xcfe0ff, transparent:true, opacity:0.9 });
      scene.add(new THREE.Points(g,m));
    })();

    /* ===== Nebula / Galaxy Sprites (canvas texture) ===== */
    function radialTex(stops){
      const c = document.createElement('canvas'); c.width=c.height=512;
      const x = c.getContext('2d');
      const g = x.createRadialGradient(256,256,10, 256,256,256);
      stops.forEach(s=>g.addColorStop(s[0], s[1]));
      x.fillStyle=g; x.fillRect(0,0,512,512);
      const t = new THREE.CanvasTexture(c); t.needsUpdate=true; return t;
    }
    function addNebula(pos, scale, palette){
      const tex = radialTex(palette);
      const mat = new THREE.SpriteMaterial({ map:tex, depthWrite:false, transparent:true, opacity:0.9, blending:THREE.AdditiveBlending });
      const spr = new THREE.Sprite(mat); spr.position.copy(pos); spr.scale.setScalar(scale); scene.add(spr);
    }
    addNebula(new THREE.Vector3(-350, 120, -500), 800, [
      [0.00,'rgba( 80, 20,140,1)'], [0.25,'rgba(120, 40,190,.75)'],
      [0.55,'rgba( 40,120,255,.45)'], [1.00,'rgba(  0,  0,  0,0)']
    ]);
    addNebula(new THREE.Vector3( 520,-80, -760), 900, [
      [0.00,'rgba( 30, 60,180,1)'], [0.25,'rgba( 60,140,255,.75)'],
      [0.60,'rgba(170,110,255,.35)'], [1.00,'rgba(  0,  0,  0,0)']
    ]);
    addNebula(new THREE.Vector3( 120, 260,  680), 700, [
      [0.00,'rgba(120, 40,200,1)'], [0.25,'rgba(190, 90,255,.75)'],
      [0.60,'rgba( 60,160,255,.35)'], [1.00,'rgba(  0,  0,  0,0)']
    ]);

    /* ===== Black Hole (far) ===== */
    (function addBlackHole(){
      const group = new THREE.Group(); group.position.set(-900, 120, -1400);
      const core = new THREE.Mesh(new THREE.SphereGeometry(40, 48, 32), new THREE.MeshBasicMaterial({ color:0x000000 }));
      group.add(core);
      function ringTexture(){
        const c = document.createElement('canvas'); c.width=c.height=512;
        const x = c.getContext('2d');
        const g = x.createRadialGradient(256,256,120, 256,256,256);
        g.addColorStop(0.00,'rgba(  0,  0,  0,0)');
        g.addColorStop(0.35,'rgba( 80,140,255,.85)');
        g.addColorStop(0.60,'rgba(170, 80,255,.60)');
        g.addColorStop(1.00,'rgba(  0,  0,  0,0)');
        x.fillStyle = g; x.fillRect(0,0,512,512);
        return new THREE.CanvasTexture(c);
      }
      const disk = new THREE.Mesh(
        new THREE.RingGeometry(90, 220, 128),
        new THREE.MeshBasicMaterial({ map:ringTexture(), side:THREE.DoubleSide, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false })
      );
      disk.rotation.x = -Math.PI/2; group.add(disk);
      const pg = new THREE.BufferGeometry(); const n=1200, arr=new Float32Array(n*3);
      for(let i=0;i<n;i++){
        const r = THREE.MathUtils.randFloat(110, 220), a = Math.random()*Math.PI*2;
        arr[i*3+0]= r*Math.cos(a); arr[i*3+1]= THREE.MathUtils.randFloatSpread(6); arr[i*3+2]= r*Math.sin(a);
      }
      pg.setAttribute('position', new THREE.BufferAttribute(arr,3));
      const ringPts = new THREE.Points(pg, new THREE.PointsMaterial({ size:3.0, color:0xaed3ff, transparent:true, opacity:0.9, blending:THREE.AdditiveBlending, depthWrite:false }));
      group.add(ringPts);
      group.userData.spin = ()=>{ disk.rotation.z += 0.0015; ringPts.rotation.y += 0.001; };
      scene.add(group);
      scene.userData.blackHole = group;
    })();

    /* ===== Projects / Planets ===== */
    const PROJECTS = [
      { id:'p1', title:'Audio Reactive + Hand Tracked Visualizer', tag:'TouchDesigner', cover:'media/covers/p1.jpg' },
      { id:'p2', title:'Odin Pendant Animation',                   tag:'3D Works',      cover:'media/covers/p2.jpg' },
      { id:'p3', title:'MediaPipe + Ableton + PointCloud',         tag:'Interactive',   cover:'media/covers/p3.jpg' },
      { id:'p4', title:'Nike Air Jordan CGI',                      tag:'CGI',           cover:'media/covers/p4.jpg' },
      { id:'p5', title:'Bic Mini Lighter Spider Case',             tag:'Product CGI',   cover:'media/covers/p5.jpg' },
      { id:'p6', title:'Space Keycap Animation',                   tag:'3D Works',      cover:'media/covers/p6.jpg' },
      { id:'p7', title:'Oxidized Silver Jewelry — Maverick',       tag:'LookDev',       cover:'media/covers/p7.jpg' },
      { id:'p8', title:'YouTube Channel Intro',                    tag:'Motion · Audio',cover:'media/covers/p8.jpg' },
      { id:'p9', title:'AI Visualizer from Image',                 tag:'AI Visuals',    cover:'media/covers/p9.jpg' }
    ];

    const overlay = document.getElementById('overlay');
    const planets = [];
    const cardsRef = [];

    function makePlanet(radius, color){
      const geo = new THREE.SphereGeometry(radius, 48, 32);
      const mat = new THREE.MeshStandardMaterial({
        color, roughness:0.85, metalness:0.15,
        emissive: (new THREE.Color(color)).multiplyScalar(0.25), emissiveIntensity:0.2
      });
      const m = new THREE.Mesh(geo, mat);
      // aura
      const ringG = new THREE.RingGeometry(radius*1.15, radius*1.45, 64);
      const ringM = new THREE.MeshBasicMaterial({ color: (new THREE.Color(color)).offsetHSL(0.08,0,0).getHex(), transparent:true, opacity:0.14, side:THREE.DoubleSide });
      const aura = new THREE.Mesh(ringG, ringM); aura.rotation.x = -Math.PI/2;
      m.add(aura); m.userData.aura = aura;
      return m;
    }

    function addCardFor(p){
      const el = document.createElement('div');
      el.className = 'planet-card';
      el.innerHTML = `
        <div class="planet-card__media" style="background-image:url('${p.cover || ''}')"></div>
        <div class="badge">${p.tag || ''}</div>
        <div class="planet-card__meta">
          <div class="title">${p.title}</div>
          <div class="tag">${p.tag || ''}</div>
        </div>`;
      overlay.appendChild(el);
      return el;
    }

    // konumları üret (dağınık, farklı yükseklik)
    const POS = [];
    for(let i=0;i<PROJECTS.length;i++){
      const ringR = THREE.MathUtils.randFloat(60, 140);
      const theta = (i/PROJECTS.length)*Math.PI*2 + Math.random()*0.6;
      const x = Math.cos(theta)*ringR + THREE.MathUtils.randFloatSpread(25);
      const z = Math.sin(theta)*ringR + THREE.MathUtils.randFloatSpread(25);
      const y = THREE.MathUtils.randFloatSpread(18);
      POS.push([x,y,z]);
    }
    for(let i=POS.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [POS[i],POS[j]]=[POS[j],POS[i]]; }

    PROJECTS.forEach((proj,i)=>{
      const radius = THREE.MathUtils.randFloat(8, 16);
      const color = new THREE.Color().setHSL(THREE.MathUtils.randFloat(0.55,0.72), THREE.MathUtils.randFloat(0.35,0.55), THREE.MathUtils.randFloat(0.45,0.65));
      const planet = makePlanet(radius, color.getHex());
      const [x,y,z] = POS[i];
      planet.position.set(x,y,z);
      planet.userData.project = proj;
      scene.add(planet);
      planets.push(planet);

      const el = addCardFor(proj);
      cardsRef.push({ el, obj: planet });
    });

    /* ===== Ship (placeholder: capsule) ===== */
    const ship = new THREE.Group(); scene.add(ship);
    const hull = new THREE.Mesh(new THREE.CapsuleGeometry(0.8, 3.2, 6, 12),
      new THREE.MeshStandardMaterial({ color:0x9aa7ff, roughness:0.6, metalness:0.2, emissive:0x10163a, emissiveIntensity:0.2 })
    );
    hull.rotation.z = Math.PI/2; ship.add(hull);
    ship.position.set(0,0,0);

    /* ===== Camera (behind -X, above +Y) ===== */
    const camOffsetLocal  = new THREE.Vector3(-16.0, 7.5, 0);
    const lookAheadLocal  = new THREE.Vector3(  6.0, 1.8, 0);
    const camPos = new THREE.Vector3(), lookAt = new THREE.Vector3();
    camera.position.copy(ship.position).add(camOffsetLocal);
    camera.lookAt(ship.position.clone().add(lookAheadLocal));
    function updateCamera(dt){
      const off = camOffsetLocal.clone().applyQuaternion(ship.quaternion);
      camPos.copy(ship.position).add(off);
      camera.position.lerp(camPos, 1 - Math.pow(0.002, dt*60));
      const la = lookAheadLocal.clone().applyQuaternion(ship.quaternion);
      lookAt.copy(ship.position).add(la);
      camera.lookAt(lookAt);
    }

    /* ===== Controls (WASD + Space/Shift) ===== */
    const keys = new Set();
    window.addEventListener('keydown', (e)=>{ keys.add(e.key.toLowerCase()); handleHotkeys(e); });
    window.addEventListener('keyup',   (e)=>{ keys.delete(e.key.toLowerCase()); });

    let vel=0, yawVel=0, vY=0;
    function updateShip(dt, t){
      const w=keys.has('w')||keys.has('arrowup');
      const s=keys.has('s')||keys.has('arrowdown');
      const a=keys.has('a')||keys.has('arrowleft');
      const d=keys.has('d')||keys.has('arrowright');
      const space=keys.has(' ');
      const shift=keys.has('shift');

      const ACC_F=3.2, ACC_B=2.0, MAX_F=6.0, MAX_B=-2.4;
      if(w) vel=Math.min(MAX_F, vel+ACC_F*dt);
      if(s) vel=Math.max(MAX_B, vel-ACC_B*dt);
      if(!w && !s) vel*=Math.pow(0.988, dt*60);

      const TURN=0.92;
      if(a) yawVel+=TURN*dt;
      if(d) yawVel-=TURN*dt;
      yawVel=THREE.MathUtils.clamp(yawVel,-0.02,0.02);
      ship.rotation.y += yawVel;
      yawVel *= Math.pow(0.92, dt*60);

      const ACC_Y=8.0, MAX_Y=6.0;
      if(space) vY=Math.min(MAX_Y, vY+ACC_Y*dt);
      if(shift) vY=Math.max(-MAX_Y, vY-ACC_Y*dt);
      if(!space && !shift) vY*=Math.pow(0.92, dt*60);

      const fwd = new THREE.Vector3(1,0,0).applyQuaternion(ship.quaternion);
      ship.position.addScaledVector(fwd, vel*dt*3.0);
      ship.position.y += vY*dt;
      ship.position.y = THREE.MathUtils.clamp(ship.position.y, -25, 25);

      ship.rotation.z = Math.sin(t*0.7 + ship.position.x*0.01)*0.01;
      ship.rotation.x = Math.cos(t*0.8 + ship.position.z*0.01)*0.008;
    }

    /* ===== Overlay Cards & Hint ===== */
    const tmpV = new THREE.Vector3();
    function clamp1(v, min, max){ return Math.max(min, Math.min(max, v)); }

    const hintEl = document.getElementById('hint');
    let nearest = null;

    function updateCardsAndHint(){
      const W = window.innerWidth, H = window.innerHeight;
      let best=null, dmin=Infinity;

      for(const {el, obj} of cardsRef){
        // kart yerleşimi
        tmpV.copy(obj.position); tmpV.y += 10; tmpV.project(camera);
        let x = (tmpV.x*0.5+0.5)*W, y = (-tmpV.y*0.5+0.5)*H;
        const onScreen = tmpV.z < 1 && tmpV.z > -1;
        if(onScreen){
          x = clamp1(x, 18, W-18); y = clamp1(y, 80, H-96);
          el.style.left = x+'px'; el.style.top = y+'px';
          const dist = camera.position.distanceTo(obj.position);
          const alpha = THREE.MathUtils.clamp(1 - (dist-60)/220, 0, 1);
          el.style.opacity = alpha;
          el.style.transform = `translate(-50%,-100%) scale(${0.9 + alpha*0.12})`;
        } else { el.style.opacity = 0; }

        // yakınlık ölç
        const d = ship.position.distanceTo(obj.position);
        if(d < dmin){ dmin = d; best = obj; }
      }

      // E ipucu
      const TH = 28;
      nearest = (best && dmin < TH) ? best : null;
      if(nearest){
        tmpV.copy(nearest.position); tmpV.y += 12; tmpV.project(camera);
        if(tmpV.z<1 && tmpV.z>-1){
          let x = (tmpV.x*0.5+0.5)*W, y = (-tmpV.y*0.5+0.5)*H;
          x = clamp1(x, 18, W-18); y = clamp1(y, 60, H-80);
          hintEl.style.left = x+'px'; hintEl.style.top = y+'px';
          hintEl.style.display = 'block';
        } else { hintEl.style.display = 'none'; }
      } else { hintEl.style.display = 'none'; }
    }

    /* ===== Quick View ===== */
    const qv = document.getElementById('quickview');
    const qvTitle = document.getElementById('qvTitle');
    const qvTag   = document.getElementById('qvTag');
    const qvMedia = document.getElementById('qvMedia');
    const qvClose = document.getElementById('qvClose');
    const qvEnter = document.getElementById('qvEnter');
    const qvExit  = document.getElementById('qvExit');

    function qvOpenFor(planet){
      const p = planet.userData.project;
      qvTitle.textContent = p.title;
      qvTag.textContent   = p.tag || '';
      qvMedia.style.backgroundImage = `url('${p.cover || ''}')`;
      qv.classList.add('show');
    }
    function qvCloseFn(){ qv.classList.remove('show'); }

    qvClose.addEventListener('click', qvCloseFn);
    qvExit .addEventListener('click', qvCloseFn);
    qvEnter.addEventListener('click', ()=>{ qv.classList.add('pulse'); setTimeout(()=> qv.classList.remove('pulse'), 220); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') qvCloseFn(); });

    function handleHotkeys(e){
      const k = e.key.toLowerCase();
      if(k==='e' && nearest && !qv.classList.contains('show')) qvOpenFor(nearest);
      if(k==='q') qvCloseFn();
    }

    // tıklayınca da aç (yakındaysa)
    renderer.domElement.addEventListener('click', ()=>{
      if(nearest && !qv.classList.contains('show')) qvOpenFor(nearest);
    });

    /* ===== Resize & Loop ===== */
    function onResize(){
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    }
    window.addEventListener('resize', onResize);

    const clock = new THREE.Clock();
    function loop(){
      const dt = Math.min(0.033, clock.getDelta());
      const t  = clock.getElapsedTime();

      updateShip(dt, t);
      updateCamera(dt);
      updateCardsAndHint();
      if(scene.userData.blackHole?.userData.spin) scene.userData.blackHole.userData.spin();

      renderer.render(scene, camera);
      requestAnimationFrame(loop);
    }
    loop();

    // klavye için ilk tıklamada odak
    window.addEventListener('click', ()=> canvas.focus(), {once:true});
  </script>
</body>
</html>
