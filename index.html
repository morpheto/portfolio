<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Orhun Ege Eker — Space Portfolio</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;800&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#05060a; --text:#f6f7fb; --muted:#cbd5e1; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
  canvas#scene{position:fixed;inset:0;width:100%;height:100%;display:block;outline:none}

  .hud{position:fixed;top:12px;left:12px;right:12px;z-index:20;display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:rgba(8,10,18,.45);backdrop-filter:blur(8px) saturate(140%);border:1px solid rgba(255,255,255,.12);border-radius:16px}
  .brand{font-weight:800;letter-spacing:.4px;font-size:16px}
  .nav{display:flex;gap:16px}
  .nav a{color:var(--text);text-decoration:none;opacity:.9;position:relative;font-size:14px}
  .nav a:after{content:"";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:#2b2d33;transform:scaleX(0);transform-origin:left;transition:transform .25s}
  .nav a:hover{opacity:1}.nav a:hover:after{transform:scaleX(1)}

  .help{position:fixed;right:12px;bottom:12px;z-index:20;color:var(--muted);font-size:12px;line-height:1.5;padding:10px 12px;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(255,255,255,.06);backdrop-filter:blur(6px)}
  @media (pointer:coarse){ .help{top:64px;right:12px;bottom:auto;font-size:11px;padding:8px 10px} }

  .overlay{position:fixed;inset:0;pointer-events:none;z-index:12}
  .planet-card{position:absolute;transform:translate(-50%,-100%);width:240px;max-width:40vw;border-radius:12px;overflow:hidden;border:1px solid rgba(120,198,255,.28);background:linear-gradient(180deg, rgba(20,24,40,.85), rgba(10,12,20,.9));box-shadow:0 10px 26px rgba(0,0,0,.45);transition:opacity .15s ease, transform .15s ease;opacity:.0; pointer-events:auto}
  .planet-card__media{height:120px;background:#0f1430;background-image:radial-gradient(1200px 300px at 50% -200px, rgba(120,198,255,.35), rgba(120,198,255,0)), radial-gradient(600px 180px at 50% -80px, rgba(170,110,255,.22), rgba(170,110,255,0)); background-size:cover;background-position:center}
  .planet-card__meta{display:flex;justify-content:space-between;align-items:center;padding:8px 10px}
  .title{font-weight:700}.tag{font-size:12px;color:#e5eaf3;opacity:.85}
  .badge{position:absolute;left:8px;top:8px;background:rgba(64,191,255,.12);border:1px solid rgba(64,191,255,.4);backdrop-filter:blur(6px);font-size:11px;padding:6px 8px;border-radius:999px;color:#cfefff}
  .hint{position:absolute;transform:translate(-50%,-120%);padding:6px 10px;border-radius:999px;border:1px solid rgba(120,198,255,.35);background:rgba(64,191,255,.10);color:#dff2ff;font-size:12px;pointer-events:none;box-shadow:0 0 16px rgba(64,191,255,.25);z-index:25;display:none}

  .popup{position:fixed;inset:0;z-index:30;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);backdrop-filter:blur(4px)}
  .popup.show{display:flex}
  .popup-card{width:min(780px,92vw);border:1px solid rgba(120,198,255,.28);border-radius:16px;background:#0b0f1c;box-shadow:0 20px 60px rgba(0,0,0,.55);overflow:hidden}
  .popup-media{height:min(52vh,460px);background:#0e1433;background-size:cover;background-position:center}
  .popup-body{padding:12px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
  .popup-title{font-weight:800;font-size:18px}.popup-tag{font-size:12px;color:#cfd6e3}
  .popup-actions{display:flex;gap:10px}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid rgba(120,198,255,.3);background:#10172b;color:#fff;font-size:14px;cursor:pointer}
  .btn:hover{background:#13203a}.btn.primary{background:#1e5eff;border-color:#2b66ff}.btn.primary:hover{background:#2a6bff}
  .popup-close{position:absolute;top:12px;right:12px;border:1px solid rgba(120,198,255,.3);background:rgba(64,191,255,.08);border-radius:10px;padding:6px 10px;cursor:pointer}

  .touch-only{display:none}
  .joystick{position:fixed;z-index:35;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.15);backdrop-filter:blur(6px)}
  .joystick .knob{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:52px;height:52px;border-radius:50%;background:rgba(200,220,255,.25);border:1px solid rgba(200,220,255,.35)}
  .btn-vert{position:fixed;z-index:35;right:16px;bottom:140px;display:flex;flex-direction:column;gap:10px}
  .btn-vert button{width:60px;height:60px;border-radius:12px;border:1px solid rgba(120,198,255,.35);background:rgba(64,191,255,.12);color:#e9f4ff;font-weight:700}
  @media (pointer:coarse){ .touch-only{display:block} }
</style>
</head>
<body>
  <div class="hud">
    <div class="brand">ORHUN EGE EKER</div>
    <div class="nav"><a href="index.html">WORK</a><a href="about.html">ABOUT</a><a href="contact.html">CONTACT</a></div>
  </div>

  <div class="help" id="helpBox">Loading controls…</div>

  <div class="overlay" id="overlay"></div>
  <div class="hint" id="hint">Press <b>E</b> to View</div>

  <div class="popup" id="quickview">
    <div class="popup-card" role="dialog" aria-modal="true">
      <button class="popup-close" id="qvClose" aria-label="Close">✕</button>
      <div class="popup-media" id="qvMedia"></div>
      <div class="popup-body">
        <div><div class="popup-title" id="qvTitle">Project</div><div class="popup-tag" id="qvTag">Category</div></div>
        <div class="popup-actions"><button class="btn primary" id="qvEnter">Enter</button><button class="btn" id="qvExit">Exit</button></div>
      </div>
    </div>
  </div>

  <!-- Mobile controls -->
  <div class="touch-only">
    <div id="joyL" class="joystick" style="left:16px;bottom:24px"><div class="knob"></div></div>
    <div id="aimZone" style="position:fixed;right:0;bottom:0;top:0;width:48%;z-index:34;"></div>
    <div class="btn-vert"><button id="btnUp">UP</button><button id="btnDown">DOWN</button></div>
  </div>

  <canvas id="scene"></canvas>

  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script>
  /* ---------- Helpers & Textures ---------- */
  function makeRadialTexture(inner, outer, size=128){
    const c=document.createElement('canvas'); c.width=c.height=size;
    const ctx=c.getContext('2d');
    const g=ctx.createRadialGradient(size/2,size/2,0,size/2,size/2,size/2);
    g.addColorStop(0, inner); g.addColorStop(1, outer);
    ctx.fillStyle=g; ctx.fillRect(0,0,size,size);
    const tex=new THREE.CanvasTexture(c); tex.minFilter=THREE.LinearFilter; tex.magFilter=THREE.LinearFilter; tex.anisotropy=4;
    return tex;
  }
  const flameTex = makeRadialTexture('rgba(255,200,80,1)','rgba(255,120,0,0)');
  const smokeTex = makeRadialTexture('rgba(220,230,245,0.6)','rgba(130,140,155,0.0)');

  /* ---------- Scene ---------- */
  const canvas = document.getElementById('scene');
  const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
  renderer.setPixelRatio(Math.min(2, devicePixelRatio||1));
  renderer.setSize(innerWidth, innerHeight);
  const scene = new THREE.Scene(); scene.background=new THREE.Color(0x05060a);
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 6000);

  scene.add(new THREE.HemisphereLight(0x89b4ff, 0x05060a, .55));
  const key = new THREE.DirectionalLight(0xffffff,.85); key.position.set(160,220,120); scene.add(key);

  /* ---------- Stars ---------- */
  (function stars(){
    const g=new THREE.BufferGeometry(), N=3500, pos=new Float32Array(N*3);
    for(let i=0;i<N;i++){const r=800+Math.random()*1500, th=Math.random()*Math.PI*2, u=Math.random()*2-1, s=Math.sqrt(1-u*u);
      pos[i*3]=r*s*Math.cos(th); pos[i*3+1]=r*u*0.7; pos[i*3+2]=r*s*Math.sin(th);}
    g.setAttribute('position', new THREE.BufferAttribute(pos,3));
    scene.add(new THREE.Points(g,new THREE.PointsMaterial({size:1.6,color:0xbfd9ff,sizeAttenuation:true})));
  })();

  /* ---------- Projects ---------- */
  const PROJECTS=[{id:'p1',title:'Audio Reactive + Hand Tracked Visualizer',tag:'TouchDesigner',cover:'media/covers/p1.jpg'},
  {id:'p2',title:'Odin Pendant Animation',tag:'3D Works',cover:'media/covers/p2.jpg'},
  {id:'p3',title:'MediaPipe + Ableton + PointCloud',tag:'Interactive',cover:'media/covers/p3.jpg'},
  {id:'p4',title:'Nike Air Jordan CGI',tag:'CGI',cover:'media/covers/p4.jpg'},
  {id:'p5',title:'Bic Mini Lighter Spider Case',tag:'Product CGI',cover:'media/covers/p5.jpg'},
  {id:'p6',title:'Space Keycap Animation',tag:'3D Works',cover:'media/covers/p6.jpg'},
  {id:'p7',title:'Oxidized Silver Jewelry — Maverick',tag:'LookDev',cover:'media/covers/p7.jpg'},
  {id:'p8',title:'YouTube Channel Intro',tag:'Motion · Audio',cover:'media/covers/p8.jpg'},
  {id:'p9',title:'AI Visualizer from Image',tag:'AI Visuals',cover:'media/covers/p9.jpg'}];

  const overlay=document.getElementById('overlay'), hintEl=document.getElementById('hint'), helpBox=document.getElementById('helpBox');
  const planets=[], cardsRef=[], tmpV=new THREE.Vector3();

  function makePlanet(r,color){
    const m=new THREE.Mesh(new THREE.SphereGeometry(r,48,32),
      new THREE.MeshStandardMaterial({color,roughness:.8,metalness:.12,emissive:(new THREE.Color(color)).multiplyScalar(.15)}));
    if(Math.random()<.5){
      const ring=new THREE.Mesh(new THREE.RingGeometry(r*1.2,r*1.45,64),
        new THREE.MeshBasicMaterial({color:(new THREE.Color(color)).offsetHSL(.08,0,0).getHex(),transparent:true,opacity:.15,side:THREE.DoubleSide}));
      ring.rotation.x=-Math.PI/2 + THREE.MathUtils.randFloatSpread(.6);
      ring.rotation.z=Math.random()*Math.PI*2; m.add(ring);
    }
    return m;
  }

  // positions
  const POS=[], RMIN=70, RMAX=150;
  for(let i=0;i<PROJECTS.length;i++){
    const R=THREE.MathUtils.randFloat(RMIN,RMAX), th=(i/PROJECTS.length)*Math.PI*2 + Math.random()*0.6;
    POS.push([Math.cos(th)*R + THREE.MathUtils.randFloatSpread(20), THREE.MathUtils.randFloatSpread(18), Math.sin(th)*R + THREE.MathUtils.randFloatSpread(20)]);
  }
  for(let i=POS.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [POS[i],POS[j]]=[POS[j],POS[i]];}

  PROJECTS.forEach((p,i)=>{
    const r=THREE.MathUtils.randFloat(9,16);
    const col=new THREE.Color().setHSL(THREE.MathUtils.randFloat(.55,.72),.45,.58).getHex();
    const m=makePlanet(r,col); const [x,y,z]=POS[i]; m.position.set(x,y,z);
    m.userData.project=p; scene.add(m); planets.push(m);
    const el=document.createElement('div'); el.className='planet-card';
    const cover=p.cover?`background-image:url('${p.cover}')`:`background-image:none`;
    el.innerHTML=`<div class="planet-card__media" style="${cover}"></div>
    <div class="badge">${p.tag||''}</div><div class="planet-card__meta"><div class="title">${p.title}</div><div class="tag">${p.tag||''}</div></div>`;
    overlay.appendChild(el);
    const item={el, obj:m}; item.el.addEventListener('click',()=>{ if(nearest===m) qvOpenFor(m); }); cardsRef.push(item);
  });

  /* ---------- Ship & particles ---------- */
  const ship=new THREE.Group(); scene.add(ship);
  const hull=new THREE.Mesh(new THREE.CapsuleGeometry(.8,3,6,12),
    new THREE.MeshStandardMaterial({color:0x9aa7ff,roughness:.55,metalness:.2,emissive:0x10163a,emissiveIntensity:.2}));
  hull.rotation.z=Math.PI/2; ship.add(hull);

  const exhaustLocal = new THREE.Vector3(-2.0,0,0);

  // particle pools
  const flameMatBase = new THREE.SpriteMaterial({map:flameTex, depthWrite:false, depthTest:true, transparent:true, blending:THREE.AdditiveBlending, opacity:0.9, color:0xffffff});
  const smokeMatBase = new THREE.SpriteMaterial({map:smokeTex, depthWrite:false, depthTest:true, transparent:true, opacity:0.0, color:0xffffff});
  function makeSprite(mat){ const s=new THREE.Sprite(mat.clone()); s.visible=false; scene.add(s); return s; }
  const FLAME_MAX=160, SMOKE_MAX=120;
  const flamePool=[...Array(FLAME_MAX)].map(()=>makeSprite(flameMatBase));
  const smokePool=[...Array(SMOKE_MAX)].map(()=>makeSprite(smokeMatBase));
  const flameData=flamePool.map(()=>({life:0,max:0,vel:new THREE.Vector3()}));
  const smokeData=smokePool.map(()=>({life:0,max:0,vel:new THREE.Vector3()}));

  function worldFromExhaust(out){ return out.copy(exhaustLocal).applyQuaternion(ship.quaternion).add(ship.position); }
  function spawnFlame(n,intensity=1){
    for(let i=0;i<flamePool.length && n>0;i++){
      if(flameData[i].life>0) continue; n--;
      const sp=flamePool[i], d=flameData[i];
      const pos=new THREE.Vector3(); worldFromExhaust(pos); sp.position.copy(pos);
      sp.scale.setScalar(0.9 + Math.random()*1.4*intensity);
      d.max=0.35+Math.random()*0.25; d.life=d.max;
      const dir=new THREE.Vector3(-1, THREE.MathUtils.randFloatSpread(0.35), THREE.MathUtils.randFloatSpread(0.35)).applyQuaternion(ship.quaternion);
      d.vel.copy(dir.multiplyScalar(12+18*intensity)); sp.material.opacity=0.85; sp.visible=true;
    }
  }
  function spawnSmoke(n,boost=1){
    for(let i=0;i<smokePool.length && n>0;i++){
      if(smokeData[i].life>0) continue; n--;
      const sp=smokePool[i], d=smokeData[i];
      const pos=new THREE.Vector3(); worldFromExhaust(pos); sp.position.copy(pos);
      const s= 1.2 + Math.random()*2.2*boost; sp.scale.set(s,s,1);
      d.max=0.9+Math.random()*0.8; d.life=d.max;
      const dir=new THREE.Vector3(-1, THREE.MathUtils.randFloatSpread(0.25), THREE.MathUtils.randFloatSpread(0.25)).applyQuaternion(ship.quaternion);
      d.vel.copy(dir.multiplyScalar(3+2*boost)); sp.material.opacity=0.3; sp.visible=true;
    }
  }
  function updateParticles(dt){
    for(let i=0;i<flamePool.length;i++){
      const p=flamePool[i], d=flameData[i]; if(d.life<=0){p.visible=false; continue;}
      d.life-=dt; p.position.addScaledVector(d.vel,dt);
      const t=d.life/d.max; p.material.opacity=0.15+0.75*t; const s=(0.6+1.8*(1-t)); p.scale.set(s,s,1);
      if(d.life<=0) p.visible=false;
    }
    for(let i=0;i<smokePool.length;i++){
      const p=smokePool[i], d=smokeData[i]; if(d.life<=0){p.visible=false; continue;}
      d.life-=dt; p.position.addScaledVector(d.vel,dt); p.position.y += dt*0.6;
      const t=d.life/d.max; p.material.opacity=0.35*t; const s=p.scale.x*(1+0.35*dt); p.scale.set(s,s,1);
      if(d.life<=0) p.visible=false;
    }
  }

  /* ---------- Camera ---------- */
  const camOffsetLocal=new THREE.Vector3(-20,8.8,0);
  const lookAheadLocal=new THREE.Vector3( 8, 2.0,0);
  const camPos=new THREE.Vector3(), lookAt=new THREE.Vector3();
  function updateCamera(dt){
    const off=camOffsetLocal.clone().applyQuaternion(ship.quaternion);
    camPos.copy(ship.position).add(off);
    camera.position.lerp(camPos, 1 - Math.pow(0.0028, dt*60));
    const la=lookAheadLocal.clone().applyQuaternion(ship.quaternion);
    lookAt.copy(ship.position).add(la); camera.lookAt(lookAt);
  }
  camera.position.copy(ship.position).add(camOffsetLocal);
  camera.lookAt(ship.position.clone().add(lookAheadLocal));

  /* ---------- Input (desktop = mobile-like relative) ---------- */
  const isTouch = matchMedia('(pointer:coarse)').matches || ('ontouchstart' in window);
  helpBox.innerHTML = isTouch
    ? '<b>Mobile</b> — Left joystick: move/turn · Right drag: aim · Up/Down buttons · Tap card near planet: Quick View'
    : '<b>Desktop</b> — Mouse move: turn/tilt (relative) · <b>W/S</b> forward/back · <b>A/D</b> turn · <b>E</b> Quick View · <b>Q</b> Close';

  let controlsEnabled = true;
  const keyState={KeyW:false,KeyA:false,KeyS:false,KeyD:false,KeyQ:false,KeyE:false};
  function setKey(e,down){
    if(!controlsEnabled) return;
    const c=e.code; if(c in keyState){keyState[c]=down;}
    if(down&&c==='KeyE'&&nearest&&!qv.classList.contains('show')) qvOpenFor(nearest);
    if(down&&c==='KeyQ') qvCloseFn();
  }
  if(!isTouch){ addEventListener('keydown',e=>setKey(e,true)); addEventListener('keyup',e=>setKey(e,false)); }

  // Desktop: relative mouse (delta) -> yaw/pitch hızına katkı (mobil joystick gibi)
  let lastX=null, lastY=null, yawVel=0, pitchVel=0;
  const M_SENS_X = 0.0016;    // yatay hassasiyet
  const M_SENS_Y = 0.0014;    // dikey hassasiyet
  const YAW_DAMP  = 0.90;     // hızın sönümü
  const PITCH_DAMP= 0.90;
  const MAX_YAW_RATE = 2.8;   // rad/s tavan
  addEventListener('mousemove',e=>{
    if(!controlsEnabled || isTouch) return;
    if(lastX===null){ lastX=e.clientX; lastY=e.clientY; return; }
    const dx=e.clientX-lastX, dy=e.clientY-lastY; lastX=e.clientX; lastY=e.clientY;
    yawVel   += dx * M_SENS_X;       // sağa hareket -> pozitif yaw
    pitchVel += -dy * M_SENS_Y;      // yukarı hareket -> pozitif pitch (yukarı bak)
  }, {passive:true});
  addEventListener('mouseleave',()=>{ lastX=lastY=null; });
  addEventListener('blur',()=>{ lastX=lastY=null; });

  // Mobile joystick + aim (aynı)
  let joyX=0, joyY=0, aimDX=0, aimDY=0, upHeld=false, downHeld=false;
  if(isTouch){ const joy=document.getElementById('joyL'), knob=joy.querySelector('.knob'); const rj=()=>joy.getBoundingClientRect();
    function onJoy(e){ if(!controlsEnabled) return; e.preventDefault();
      const r=rj(),t=e.touches[0]; let dx=t.clientX-(r.left+r.width/2), dy=t.clientY-(r.top+r.height/2);
      const max=r.width*.45,len=Math.hypot(dx,dy); if(len>max){dx*=max/len;dy*=max/len;} knob.style.transform=`translate(${dx}px,${dy}px)`; joyX=dx/max; joyY=-dy/max;}
    function endJoy(e){e.preventDefault(); knob.style.transform='translate(-50%,-50%)'; joyX=joyY=0;}
    joy.addEventListener('touchstart',onJoy,{passive:false}); joy.addEventListener('touchmove',onJoy,{passive:false}); joy.addEventListener('touchend',endJoy,{passive:false});
    const aimZ=document.getElementById('aimZone'); let ax=0,ay=0,act=false; function aStart(e){ if(!controlsEnabled) return; e.preventDefault();act=true;const t=e.touches[0];ax=t.clientX;ay=t.clientY;}
    function aMove(e){ if(!controlsEnabled) return; e.preventDefault(); if(!act)return; const t=e.touches[0]; const dx=t.clientX-ax, dy=t.clientY-ay; ax=t.clientX; ay=t.clientY; aimDX-=dx*0.0016; aimDY-=dy*0.0016;}
    function aEnd(e){e.preventDefault();act=false;}
    aimZ.addEventListener('touchstart',aStart,{passive:false}); aimZ.addEventListener('touchmove',aMove,{passive:false}); aimZ.addEventListener('touchend',aEnd,{passive:false});
    document.getElementById('btnUp').addEventListener('touchstart',e=>{ if(!controlsEnabled) return; e.preventDefault();upHeld=true;},{passive:false});
    document.getElementById('btnUp').addEventListener('touchend',e=>{e.preventDefault();upHeld=false;},{passive:false});
    document.getElementById('btnDown').addEventListener('touchstart',e=>{ if(!controlsEnabled) return; e.preventDefault();downHeld=true;},{passive:false});
    document.getElementById('btnDown').addEventListener('touchend',e=>{e.preventDefault();downHeld=false;},{passive:false});
  }

  /* ---------- Movement (relative aim + inertia) ---------- */
  let velF=0, vY=0, yaw=0, pitch=0, throttle=0, prevThrottle=0, turnKeyVel=0;
  function updateShip(dt){
    if(!controlsEnabled){
      velF*=Math.pow(0.94,dt*60); yawVel*=Math.pow(0.92,dt*60); pitchVel*=Math.pow(0.92,dt*60);
      updateParticles(dt); return;
    }

    // klavye katkısı
    let fwd=0, turnKey=0, updn=0;
    if(!isTouch){
      if(keyState.KeyW) fwd+=1;
      if(keyState.KeyS) fwd-=1;
      if(keyState.KeyD) turnKey -= 1;
      if(keyState.KeyA) turnKey += 1;
    } else {
      fwd = joyY;  turnKey = -joyX;
      if(upHeld) updn += 1; if(downHeld) updn -= 1;
      // mobil incelik
      yaw += aimDX; pitch += aimDY; aimDX*=Math.pow(.92,dt*60); aimDY*=Math.pow(.92,dt*60);
    }

    // mouse delta hızlarını sönümle
    yawVel   *= Math.pow(YAW_DAMP, dt*60);
    pitchVel *= Math.pow(PITCH_DAMP, dt*60);

    // klavye dönüş katkısını yumuşat
    turnKeyVel = THREE.MathUtils.damp(turnKeyVel, turnKey*1.2, 6, dt);

    // yaw/pitch güncelle
    const yawRate   = THREE.MathUtils.clamp((yawVel + turnKeyVel)*3.0, -MAX_YAW_RATE, MAX_YAW_RATE);
    const pitchRate = THREE.MathUtils.clamp(pitchVel*3.0, -1.6, 1.6);
    yaw   += yawRate   * dt;
    pitch += pitchRate * dt;
    pitch = THREE.MathUtils.clamp(pitch, -Math.PI/3, Math.PI/3);

    // throttle & hız (coasting/fren)
    const ACC = (isTouch? 16 : 26);
    const MAX = (isTouch? 15 : 26);
    const DRAG_COAST = 0.985, DRAG_ACTIVE=0.96, DRAG_BRAKE = 0.90;

    const targetThrottle = Math.max(0, fwd);
    throttle += (targetThrottle - throttle) * (1 - Math.pow(0.2, dt*60));
    velF += throttle * ACC * dt;
    if(fwd < 0) velF += fwd * ACC * dt;

    const drag = (fwd < 0) ? DRAG_BRAKE : (throttle>0.02 ? DRAG_ACTIVE : DRAG_COAST);
    velF *= Math.pow(drag, dt*60);
    velF = THREE.MathUtils.clamp(velF, -MAX, MAX);

    // görsel roll
    const targetRoll = -(yawVel + turnKeyVel)*0.25;
    ship.rotation.set(pitch, yaw, THREE.MathUtils.damp(ship.rotation.z, targetRoll, 8, dt));

    // hareket
    const forward=new THREE.Vector3(1,0,0).applyQuaternion(ship.quaternion);
    ship.position.addScaledVector(forward, velF*dt);
    if(isTouch) ship.position.y += (updn*8)*dt;
    ship.position.y += Math.sin(pitch)*velF*.75*dt;
    ship.position.y  = THREE.MathUtils.clamp(ship.position.y, -70, 70);

    // partiküller
    const speedAbs = Math.abs(velF);
    const flameRate = Math.floor( 6 + 14*THREE.MathUtils.clamp(throttle + speedAbs/20, 0, 1.5) );
    if(throttle>0.01) spawnFlame(flameRate, THREE.MathUtils.clamp(throttle + speedAbs/30, .6, 1.6));
    if(prevThrottle>0.25 && throttle<=0.02) spawnSmoke(24, 1.4);
    if((throttle<=0.02 && speedAbs>2) || fwd<0) spawnSmoke(2, 1.0 + (fwd<0?0.6:0));
    prevThrottle = throttle;

    updateParticles(dt);
  }

  /* ---------- Overlay & hint ---------- */
  function clamp1(v,min,max){return Math.max(min,Math.min(max,v));}
  let nearest=null;
  function updateCardsAndHint(){
    const W=innerWidth,H=innerHeight; let best=null,dmin=Infinity;
    for(const {el,obj} of cardsRef){
      if(!obj) continue;
      tmpV.copy(obj.position); tmpV.y+=10; tmpV.project(camera);
      const on=tmpV.z<1&&tmpV.z>-1; let x=(tmpV.x*.5+.5)*W, y=(-tmpV.y*.5+.5)*H;
      if(on){
        x=clamp1(x,18,W-18); y=clamp1(y,80,H-96); el.style.left=x+'px'; el.style.top=y+'px';
        const dist=camera.position.distanceTo(obj.position); const a=THREE.MathUtils.clamp(1-(dist-60)/220,0,1);
        el.style.opacity=a; el.style.transform=`translate(-50%,-100%) scale(${0.92+a*0.1})`;
      } else el.style.opacity=0;
      const d=ship.position.distanceTo(obj.position); if(d<dmin){ dmin=d; best=obj; }
    }
    const TH=28; nearest=(best&&dmin<TH)?best:null;
    if(nearest && controlsEnabled){
      tmpV.copy(nearest.position); tmpV.y+=12; tmpV.project(camera);
      if(tmpV.z<1&&tmpV.z>-1){ let x=(tmpV.x*.5+.5)*W, y=(-tmpV.y*.5+.5)*H; x=clamp1(x,18,W-18); y=clamp1(y,60,H-80);
        hintEl.textContent = (isTouch?'Tap card or E':'Press E or click card'); hintEl.style.left=x+'px'; hintEl.style.top=y+'px'; hintEl.style.display='block';
      } else hintEl.style.display='none';
    } else hintEl.style.display='none';
  }

  /* ---------- Quick View ---------- */
  const qv=document.getElementById('quickview'), qvTitle=document.getElementById('qvTitle'),
        qvTag=document.getElementById('qvTag'), qvMedia=document.getElementById('qvMedia'),
        qvClose=document.getElementById('qvClose'), qvExit=document.getElementById('qvExit');
  function qvOpenFor(planet){
    controlsEnabled = false;
    const p=planet.userData.project; qvTitle.textContent=p.title; qvTag.textContent=p.tag||''; qvMedia.style.backgroundImage=`url('${p.cover||''}')`;
    qv.classList.add('show');
  }
  function qvCloseFn(){ qv.classList.remove('show'); controlsEnabled = true; lastX=lastY=null; }
  qvClose.addEventListener('click', qvCloseFn); qvExit.addEventListener('click', qvCloseFn);

  /* ---------- Tick ---------- */
  addEventListener('resize',()=>{renderer.setSize(innerWidth,innerHeight); camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix();});
  const clock=new THREE.Clock();
  function loop(){ const dt=Math.min(.033,clock.getDelta()); updateShip(dt); updateCamera(dt); updateParticles(dt); updateCardsAndHint(); renderer.render(scene,camera); requestAnimationFrame(loop); }
  loop();
  </script>
</body>
</html>
